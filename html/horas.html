<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="utf-8" />
  <title>Distribuição das Ocorrências por Hora</title>
</head>
<body>
  <div id="container" style="width: 80%; height: 400px;"></div>
  <script src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

  <script>
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, null, {
      renderer: 'canvas',
      useDirtyRect: false
    });

    const horas = [
      '0h', '1h', '2h', '3h', '4h', '5h',
      '6h', '7h', '8h', '9h', '10h', '11h',
      '12h', '13h', '14h', '15h', '16h', '17h',
      '18h', '19h', '20h', '21h', '22h', '23h'
    ];

    function corPorValor(valor) {
      if (valor >= 11) return '#c50505'; 
      if (valor >= 7) return '#f03232';  
      if (valor >= 4) return '#ee940e';  
      return '#e9ec0e';                  
    }

    fetch('../json/cvli.json')
      .then(response => response.json())
      .then(dados => {
        const contagemHoras = new Array(24).fill(0);

        dados.forEach(item => {
          const hora = item.hora_exata;
          if (hora >= 0 && hora <= 23) {
            contagemHoras[hora]++;
          }
        });

        const cores = contagemHoras.map(valor => corPorValor(valor));

        const option = {
          title: {
            text: 'Distribuição das Ocorrências por Hora (00h ~ 23h)',
            left: 'center',
            top: 0,
            textStyle: {
              color: '#333',
              fontSize: 14,
              fontWeight: 'bold'
            }
          },
          angleAxis: {
            type: 'category',
            startAngle: 0,
            data: horas
          },
          radiusAxis: {
            axisLabel: {
              distance: 30,
              color: '#333',
              fontSize: 10
            },
            splitLine: {
              lineStyle: {
                color: '#ccc'
              }
            }
          },
          polar: {
            center: ['50%', '50%'],
            radius: [10, '80%']
          },
          tooltip: {
            trigger: 'item',
            formatter: function (params) {
              return `${params.name}: ${params.value} ocorrências`;
            }
          },
          legend: { show: false },
          series: [
            {
              type: 'bar',
              data: contagemHoras,
              coordinateSystem: 'polar',
              name: 'Ocorrências',
              stack: 'a',
              itemStyle: {
                color: function (params) {
                  return cores[params.dataIndex];
                }
              },
              emphasis: { focus: 'series' }
            }
          ]
        };

        myChart.setOption(option);
        window.addEventListener('resize', myChart.resize);
      })
      .catch(error => {
        console.error('Erro ao carregar o JSON:', error);
      });
  </script>
</body>
</html>